{% extends 'base.html' %}

{% block content %}
<div class="container mt-4">
    <div class="d-flex justify-content-between align-items-center mb-3">
        <div class="d-flex align-items-center">
            <h2 class="mb-0">Manager List for CSV Mapping</h2>
            <a href="#" class="ms-3" data-bs-toggle="modal" data-bs-target="#helpModal" aria-label="Help with creation rules">
                <i class="bi bi-question-circle-fill fs-4"></i>
            </a>
        </div>
        <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#addManagerModal">
            Add Manager
        </button>
    </div>
    <p>Use this list to create your <code>manager_mapping.csv</code> file. The <strong>Django Username</strong> is what you need for the mapping.</p>

    <div class="table-responsive">
        <table class="table table-striped table-bordered">
            <thead class="table-dark">
                <tr>
                    <th>Full Name (from database)</th>
                    <th>Django Username (for mapping file)</th>
                    <th>Email</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                {% for manager in managers %}
                <tr>
                    <td>{{ manager.user.get_full_name }}</td>
                    <td><strong>{{ manager.user.username }}</strong></td>
                    <td>{{ manager.user.email }}</td>
                    <td>
                        <a href="{% url 'employees:edit_employee' pk=manager.pk %}" class="btn btn-sm btn-outline-secondary">Edit</a>
                    </td>
                </tr>
                {% empty %}
                <tr>
                    <td colspan="4" class="text-center">No employees with the role 'Manager' found.</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>

<!-- Add Manager Modal -->
<div class="modal fade" id="addManagerModal" tabindex="-1" aria-labelledby="addManagerModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="addManagerModalLabel">Add New Manager</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <form method="post" action="{% url 'employees:add_manager' %}">
            {% csrf_token %}
            {{ form.as_p }}
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                <button type="submit" class="btn btn-primary">Save Manager</button>
            </div>
        </form>
      </div>
    </div>
  </div>
</div>

<!-- Help Modal -->
<div class="modal fade" id="helpModal" tabindex="-1" aria-labelledby="helpModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="helpModalLabel">Règles de Création Automatique des Employés</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <p>Lors de la création d'un nouvel employé via le formulaire "Add Manager", plusieurs champs sont générés automatiquement pour assurer la cohérence et la sécurité.</p>
        
        <h6>Nom d'utilisateur (Username)</h6>
        <ul>
            <li>Généré à partir de la <strong>première lettre du prénom</strong> et des <strong>8 premières lettres du nom de famille</strong>.</li>
            <li>Exemple : <em>Jean-Claude Van Damme</em> → <code>jvandamme</code>.</li>
            <li>Le système assure que chaque nom d'utilisateur est unique. Si <code>jvandamme</code> existe, il essaiera <code>jvandamme1</code>, <code>jvandamme2</code>, etc.</li>
        </ul>

        <h6>Adresse Courriel (Email)</h6>
        <ul>
            <li>Générée en joignant le prénom et le nom de famille avec un point, suivi de <code>@hobart.ca</code>.</li>
            <li>Les caractères accentués (comme <code>é</code>, <code>à</code>) sont remplacés par leur équivalent simple (e.g., <code>e</code>, <code>a</code>).</li>
            <li>Les espaces et les tirets sont supprimés.</li>
            <li>Exemple : <em>Dave Doré</em> → <code>dave.dore@hobart.ca</code>.</li>
            <li>Le système assure que chaque adresse courriel est unique.</li>
        </ul>

        <h6>Code Employé</h6>
        <ul>
            <li>Généré à partir de la <strong>première lettre du prénom</strong> et de la <strong>première lettre du nom de famille</strong>.</li>
            <li>Exemple : <em>Dave Doré</em> → <code>DD</code>.</li>
            <li>Le système assure que chaque code est unique en ajoutant un numéro à la fin. Si <code>DD1</code> et <code>DD2</code> existent, le prochain sera <code>DD3</code>.</li>
        </ul>

        <h6>Mot de passe (Password)</h6>
        <ul>
            <li><strong>Aucun mot de passe n'est défini à la création.</strong> Le compte est créé avec un mot de passe inutilisable.</li>
            <li>L'employé devra utiliser la fonction "mot de passe oublié" pour définir son propre mot de passe lors de sa première connexion.</li>
        </ul>

        <p class="mt-3">La modification du nom ou du prénom d'un employé via le bouton "Edit" régénérera automatiquement ces trois champs pour maintenir la cohérence.</p>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Fermer</button>
      </div>
    </div>
  </div>
</div>
{% endblock %}
